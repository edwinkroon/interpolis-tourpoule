<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interpolis Tourspel - Welkom</title>
  <link rel="stylesheet" href="styles/grid.css">
  <link rel="stylesheet" href="styles/style.css">
  <script src="auth0-spa-js.production.js"></script>
  <script src="auth-config.js"></script>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content page">
      <div class="grid">
        <div class="col-12">
          <h1 class="header-title">Interpolis tourspel</h1>
        </div>
        <div class="col-12">
          <div class="header-welcome-section">
            <h2 class="welcome-heading">Welkom</h2>
            <div class="header-illustration">
              <img src="assets/headerillustration.svg" alt="Fiets illustratie" class="illustration-svg">
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content page">
    <div class="grid">
      <!-- Action Buttons -->
      <div class="action-buttons col-3">
        <button class="action-button">
          <span>Spelregels</span>
          <img src="assets/arrow.svg" alt="" class="action-arrow">
        </button>
        <button class="action-button">
          <span>Statistieken</span>
          <img src="assets/arrow.svg" alt="" class="action-arrow">
        </button>
        <button class="action-button" id="logout-button">
          <span>Uitloggen</span>
          <img src="assets/arrow.svg" alt="" class="action-arrow">
        </button>
      </div>

      <!-- Form Card -->
      <div class="form-card col-9">
        <h3 class="form-title">Wie ben je?</h3>
        <p class="form-description">
          Geef hier de teamnaam op waarmee jouw team zichtbaar is binnen het tourspel. Daarnaast kan 
          je nog een avatar uploaden en je emailadres opgeven zodat we je updates kunnen sturen. De 
          avatar en het emailadres zijn niet verplicht
        </p>

        <div class="grid">
          <!-- Team Name Field -->
          <div class="form-group col-6">
            <label for="teamname" class="form-label">Teamnaam</label>
            <input 
              type="text" 
              id="teamname" 
              name="teamname" 
              class="form-input" 
              placeholder="Vul je teamnaam hier in"
            >
            <span class="error-message" id="teamname-error" role="alert"></span>
          </div>
        </div>

        <div class="grid">
          <!-- Email Field -->
          <div class="form-group col-6">
            <label for="email" class="form-label">Emailadres</label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              class="form-input" 
              placeholder="Vul je e-mail adres hier in"
            >
            <span class="error-message" id="email-error" role="alert"></span>
          </div>
        </div>

        <!-- Avatar Upload -->
        <div class="avatar-section">
          <div class="avatar-circle">
            <div class="avatar-placeholder" id="avatar-placeholder">
              <span class="avatar-icon" id="avatar-icon">+</span>
              <img id="avatar-preview" class="avatar-preview" src="" alt="Avatar preview" style="display: none;">
            </div>
            <input type="file" id="avatar-input" accept="image/*" style="display: none;">
          </div>
          <div class="avatar-info">
            <a href="#" class="avatar-link" id="avatar-link">Avatar toevoegen</a>
            <p class="avatar-tip">Tip: Met een vierkante afbeelding heb je een beter resultaat</p>
          </div>
        </div>

        <!-- Checkbox -->
        <div class="checkbox-group">
          <input type="checkbox" id="newsletter" name="newsletter" class="checkbox-input" checked>
          <label for="newsletter" class="checkbox-label">Ik wil op de hoogte blijven</label>
        </div>

        <!-- Navigation Buttons -->
        <div class="navigation-buttons">
          <button type="button" class="nav-button nav-button-prev" id="prev-button">
            <img src="assets/arrow.svg" alt="" class="nav-arrow nav-arrow-left">
            <span>vorige</span>
          </button>
          <button type="button" class="nav-button nav-button-next" id="next-button">
            <span>volgende</span>
            <img src="assets/arrow.svg" alt="" class="nav-arrow nav-arrow-right">
          </button>
        </div>
      </div>
  </main>

  <script>
    let auth0Client;

    async function initAuth() {
      if (typeof auth0 === 'undefined') {
        return;
      }

      try {
        auth0Client = await auth0.createAuth0Client({
          domain: AUTH0_CONFIG.domain,
          clientId: AUTH0_CONFIG.clientId,
          authorizationParams: {
            redirect_uri: AUTH0_CONFIG.redirectUri
          }
        });
      } catch (error) {
        console.error('Fout bij initialiseren van Auth0:', error);
      }
    }

    async function logout() {
      if (!auth0Client) {
        console.error('Auth0 client niet ge√Ønitialiseerd');
        return;
      }

      try {
        await auth0Client.logout({
          logoutParams: {
            returnTo: window.location.origin + '/logout.html',
            federated: true
          }
        });
      } catch (error) {
        console.error('Fout bij uitloggen:', error);
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      const prevButton = document.getElementById('prev-button');
      const nextButton = document.getElementById('next-button');
      const logoutButton = document.getElementById('logout-button');
      const teamnameInput = document.getElementById('teamname');
      const emailInput = document.getElementById('email');
      const teamnameError = document.getElementById('teamname-error');
      const emailError = document.getElementById('email-error');

      // Initialize Auth0
      setTimeout(initAuth, 100);

      // Handle previous button click
      prevButton.addEventListener('click', function(e) {
        e.preventDefault();
        window.location.href = 'index.html';
      });

      function validateForm() {
        let isValid = true;
        
        // Reset errors
        teamnameError.textContent = '';
        emailError.textContent = '';
        teamnameInput.classList.remove('error');
        emailInput.classList.remove('error');

        // Validate teamname
        if (!teamnameInput.value.trim()) {
          teamnameError.textContent = 'Vul een teamnaam in om door te gaan';
          teamnameInput.classList.add('error');
          isValid = false;
        }

        // Validate email
        if (!emailInput.value.trim()) {
          emailError.textContent = 'Vul een emailadres in om door te gaan';
          emailInput.classList.add('error');
          isValid = false;
        }

        return isValid;
      }

      // Validate on next button click
      nextButton.addEventListener('click', function(e) {
        e.preventDefault();
        if (validateForm()) {
          window.location.href = 'welcome3.html';
        }
      });

      // Clear errors when user starts typing
      teamnameInput.addEventListener('input', function() {
        if (this.value.trim()) {
          this.classList.remove('error');
          teamnameError.textContent = '';
        }
      });

      emailInput.addEventListener('input', function() {
        if (this.value.trim()) {
          this.classList.remove('error');
          emailError.textContent = '';
        }
      });

      // Avatar upload functionality
      const avatarPlaceholder = document.getElementById('avatar-placeholder');
      const avatarInput = document.getElementById('avatar-input');
      const avatarPreview = document.getElementById('avatar-preview');
      const avatarIcon = document.getElementById('avatar-icon');
      const avatarLink = document.getElementById('avatar-link');

      // Open file picker when clicking on avatar section
      avatarPlaceholder.addEventListener('click', function() {
        avatarInput.click();
      });

      avatarLink.addEventListener('click', function(e) {
        e.preventDefault();
        avatarInput.click();
      });

      // Handle file selection
      avatarInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          // Check if file is an image
          if (!file.type.startsWith('image/')) {
            alert('Selecteer een geldige afbeelding');
            return;
          }

          // Create FileReader to preview image
          const reader = new FileReader();
          reader.onload = function(event) {
            avatarPreview.src = event.target.result;
            avatarPreview.style.display = 'block';
            avatarIcon.style.display = 'none';
            avatarLink.textContent = 'Avatar aanpassen';
          };
          reader.readAsDataURL(file);
        }
      });

      // Handle logout button click
      logoutButton.addEventListener('click', function(e) {
        e.preventDefault();
        logout();
      });
    });
  </script>
</body>
</html>
